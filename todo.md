# kotemari TypeScript移植 ToDo

このToDoリストは、Python製kotemariライブラリをTypeScriptに移植するための作業手順です。

## 1. 準備
- [x] Python版kotemariリポジトリの仕様・構造を理解する
- [x] 主要API・機能の洗い出し
- [x] TypeScriptプロジェクト（kotemari-ts）をセットアップ
- [x] 必要な依存パッケージの選定・導入

## 2. コア機能の設計
- [x] Python版のクラス・関数構成をTypeScriptにマッピング
- [x] ファイル依存関係解析ロジックの設計（Python→TypeScript: import解析→import/export解析）
- [x] 各プログラミング言語に応じた依存関係解析対応（多言語拡張設計）
    - [ ] 言語判定ロジックの設計（※現状は拡張子ベースで十分なため、今は対応不要。将来的な拡張・特殊ケース対応時のみ検討）
    - [x] TypeScript依存関係解析クラスの設計・実装
    - [x] Python依存関係解析クラスの設計・実装
    - [x] Shellスクリプト依存関係解析クラスの設計・実装
    - [x] Go依存関係解析クラスの設計・実装
    - [x] Ruby依存関係解析クラスの設計・実装
    - [x] C/C++依存関係解析クラスの設計・実装
    - [x] Objective-C依存関係解析クラスの設計・実装
    - [ ] 言語ごとのテストケース設計（※主要言語の基本的なテストは完了。今後は複雑な依存や言語特有パターンの網羅が課題）
    - [ ] 言語ごとの依存関係解析クラスのAPI統一化（※現状のIDependencyAnalyzer実装で統一済。将来的な拡張・標準化の余地あり）
    - [ ] ユーザーが言語を指定/自動判定できるAPI設計（※現状は拡張子ベースで自動判定済。ユーザーによる明示指定や高度な判定は未対応。今後の拡張課題）
- [x] 設定ファイル（.kotemari.yml等）の読み込み設計
- [x] キャッシュ・ウォッチ機能の設計
- [x] **主要APIとしてREADME.mdに記載されている下記メソッドは必ずTypeScriptユーザーに提供すること：**
    - [x] Kotemari（クラス/コンストラクタ）
    - [x] analyzeProject（analyze_project）
    - [x] listFiles（list_files）
    - [x] getDependencies（get_dependencies）
    - [x] getReverseDependencies（get_reverse_dependencies）
    - [x] getContext（get_context）
    - [x] startWatching / stopWatching（start_watching / stop_watching）
    - [x] clearCache（clear_cache）

## 2.5. 多言語依存関係解析リファクタリング
- [x] 依存関係解析インターフェース（例: IDependencyAnalyzer）の定義
- [x] TypeScript依存関係解析ロジックを専用クラス（例: TypeScriptDependencyAnalyzer）として分離
- [x] analyzersディレクトリに各言語ごとの解析クラスを配置
- [x] Kotemari本体はファイル拡張子ごとに適切なアナライザーを選択して利用する設計に変更
- [x] 既存テストがすべてパスすることを確認

## 3. 実装（テスト駆動で進める）
- [ ] 多言語対応依存関係解析
    - [x] TypeScript依存関係解析クラスの実装
    - [x] TypeScript依存関係解析クラスのテスト実装
    - [x] TypeScript依存関係解析クラスのテストがパスすることを確認
    - [x] Python依存関係解析クラスの実装
    - [x] Python依存関係解析クラスのテスト実装
    - [x] Python依存関係解析クラスのテストがパスすることを確認
    - [x] Shellスクリプト依存関係解析クラスの実装
    - [x] Shellスクリプト依存関係解析クラスのテスト実装
    - [x] Shellスクリプト依存関係解析クラスのテストがパスすることを確認
    - [x] Go依存関係解析クラスの実装
    - [x] Go依存関係解析クラスのテスト実装
    - [x] Go依存関係解析クラスのテストがパスすることを確認
    - [x] Ruby依存関係解析クラスの実装
    - [x] Ruby依存関係解析クラスのテスト実装
    - [x] Ruby依存関係解析クラスのテストがパスすることを確認
    - [x] C/C++依存関係解析クラスの実装
    - [x] C/C++依存関係解析クラスのテスト実装
    - [x] C/C++依存関係解析クラスのテストがパスすることを確認
    - [x] Objective-C依存関係解析クラスの実装
    - [x] Objective-C依存関係解析クラスのテスト実装
    - [x] Objective-C依存関係解析クラスのテストがパスすることを確認

- [x] Kotemariクラスの実装
    - [x] テスト実装（プロジェクトルート・設定パス・キャッシュ・ログレベルの管理）
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] analyzeProject: プロジェクト全体の解析
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] listFiles: 解析対象ファイル一覧取得
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] getDependencies: ファイルの依存先取得
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] getReverseDependencies: 逆依存ファイル取得
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] getContext: 文脈生成API
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] startWatching/stopWatching: ファイル監視
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認
- [x] clearCache: キャッシュクリア
    - [x] テスト実装
    - [x] 実装
    - [x] テストがパスすることを確認

## 4. テスト・検証
- [x] 各APIメソッドの単体テスト作成
- [x] テスト用プロジェクトでの動作検証

## 4. LLMコンテキスト長と最適化ポリシー（設計・実装課題）
- [ ] 最大コンテキスト長のパラメータ設計
    - [ ] Kotemariクラスの初期化オプションにmaxContextLength（最大トークン数）を追加
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] 設定ファイル（例: .kotemari.yml）からも最大長を指定可能にする
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] APIドキュメント・READMEへの反映
        - [ ] ドキュメント修正
        - [ ] レビュー
- [ ] コンテキスト長制御ロジックの実装
    - [ ] 依存ファイルの連結時に最大長を超えないようトリミング・優先順位制御
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] トークン数カウントのためのユーティリティ実装（単純文字数/サブワード/実トークン数など選択肢検討）
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] テストケース作成（長い依存を持つ場合の動作検証）
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
- [ ] 利用モードごとのポリシー切り替え
    - [ ] ローカルLLM/クラウドLLM/API課金有無ごとに推奨コンテキスト長をプリセット
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] 利用モード選択用の設定・オプション追加
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] モードごとに最大長・優先順位制御が切り替わることのテスト
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
- [ ] コンテキストキャッシュの一貫性担保
    - [ ] 同一入力・依存関係で常に前方から同一のコンテキストが生成されるアルゴリズム設計
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] キャッシュキー生成・管理ロジックの実装
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス
    - [ ] キャッシュ再現性のテスト
        - [ ] テスト実装
        - [ ] 実装
        - [ ] テストがパス



## 5. ドキュメント整備
- [x] README.mdの作成・更新
- [ ] APIリファレンス作成
- [ ] 使用例・サンプルコード追加

## 6. 公開準備
- [ ] npm公開用設定（package.jsonなど）
- [ ] バージョニング・CHANGELOG作成
- [ ] ライセンス確認
- [ ] GitHubリポジトリ整備

---
必要に応じて手順を追加・修正してください。
